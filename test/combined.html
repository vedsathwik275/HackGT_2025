<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFL Field Detection Mapper</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .field-marker {
            transition: all 0.3s ease;
        }
        .field-marker:hover {
            transform: scale(1.2);
            z-index: 10;
        }
        .yard-line {
            stroke: white;
            stroke-width: 2;
            opacity: 0.8;
        }
        .hash-mark {
            stroke: white;
            stroke-width: 1;
            opacity: 0.6;
        }
        .end-zone {
            fill: #1e40af;
            opacity: 0.3;
        }
        .field-numbers {
            fill: white;
            font-family: Arial, sans-serif;
            font-weight: bold;
            font-size: 16px;
            text-anchor: middle;
        }
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .image-preview {
            max-width: 100%;
            max-height: 300px;
            object-fit: contain;
            border-radius: 8px;
            border: 2px solid #e5e7eb;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto p-6">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h1 class="text-3xl font-bold text-gray-800 mb-4">üèà NFL Field Detection Mapper</h1>
            <p class="text-gray-600 mb-4">Upload an image to automatically detect players and referees, then visualize them on an NFL field.</p>
        </div>

        <!-- Image Upload Section -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">üñºÔ∏è Image Upload & Detection</h2>
            
            <div class="grid md:grid-cols-2 gap-6">
                <!-- Upload Controls -->
                <div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Upload Football Image</label>
                        <input type="file" id="imageFile" accept="image/*" 
                               class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                    </div>
                    
                    <div class="flex flex-wrap gap-3">
                        <button id="detectPlayers" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors flex items-center gap-2" disabled>
                            <span class="loading-spinner hidden"></span>
                            <span class="button-text">üîç Detect Players</span>
                        </button>
                        <button id="loadSample" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors">
                            üìÇ Load Sample Data
                        </button>
                        <button id="loadJsonFile" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg transition-colors">
                            üìÑ Load JSON File
                        </button>
                        <button id="clearField" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors">
                            üóëÔ∏è Clear All
                        </button>
                    </div>

                    <input type="file" id="jsonFileInput" accept=".json" class="hidden">
                </div>

                <!-- Image Preview -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Image Preview</label>
                    <div id="imagePreviewContainer" class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center min-h-[200px] flex items-center justify-center">
                        <div class="text-gray-500">
                            <svg class="mx-auto h-12 w-12 mb-2" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <p>No image selected</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Processing Status -->
        <div id="processingStatus" class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6 hidden">
            <div class="flex items-center gap-3">
                <div class="loading-spinner"></div>
                <div>
                    <h3 class="font-semibold text-blue-800">Processing Image...</h3>
                    <p class="text-sm text-blue-600" id="processingMessage">Uploading image to detection service...</p>
                </div>
            </div>
        </div>

        <!-- Stats Panel -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">üìä Detection Statistics</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="bg-blue-50 p-4 rounded-lg">
                    <div class="text-2xl font-bold text-blue-600" id="playerCount">0</div>
                    <div class="text-sm text-gray-600">Players</div>
                </div>
                <div class="bg-yellow-50 p-4 rounded-lg">
                    <div class="text-2xl font-bold text-yellow-600" id="refCount">0</div>
                    <div class="text-sm text-gray-600">Referees</div>
                </div>
                <div class="bg-green-50 p-4 rounded-lg">
                    <div class="text-2xl font-bold text-green-600" id="totalCount">0</div>
                    <div class="text-sm text-gray-600">Total</div>
                </div>
                <div class="bg-purple-50 p-4 rounded-lg">
                    <div class="text-2xl font-bold text-purple-600" id="avgConfidence">0%</div>
                    <div class="text-sm text-gray-600">Avg Confidence</div>
                </div>
            </div>
        </div>

        <!-- Field Visualization -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">üèüÔ∏è Field Visualization</h2>
            <div class="flex justify-center">
                <div class="relative bg-green-600 rounded-lg p-4" style="width: 1000px; height: 533px;">
                    <svg id="nflField" width="100%" height="100%" class="border-2 border-white">
                        <!-- Field background -->
                        <rect width="100%" height="100%" fill="#2d5a27"/>
                        
                        <!-- End zones -->
                        <rect x="0" y="0" width="83.33" height="100%" class="end-zone"/>
                        <rect x="916.67" y="0" width="83.33" height="100%" class="end-zone"/>
                        
                        <!-- Yard lines -->
                        <g id="yardLines"></g>
                        
                        <!-- Hash marks -->
                        <g id="hashMarks"></g>
                        
                        <!-- Field numbers -->
                        <g id="fieldNumbers"></g>
                        
                        <!-- Detection markers will be added here -->
                        <g id="detectionMarkers"></g>
                    </svg>
                </div>
            </div>
            
            <!-- Legend -->
            <div class="mt-4 flex justify-center">
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="font-semibold text-gray-800 mb-2">Legend</h3>
                    <div class="flex flex-wrap gap-4">
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 bg-blue-500 rounded-full"></div>
                            <span class="text-sm">Players</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 bg-yellow-500 rounded-full"></div>
                            <span class="text-sm">Referees</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 bg-red-500 rounded-full"></div>
                            <span class="text-sm">Low Confidence (&lt;70%)</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detection Details -->
        <div class="bg-white rounded-lg shadow-lg p-6 mt-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">üìã Detection Details</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full table-auto">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-2 text-left">ID</th>
                            <th class="px-4 py-2 text-left">Type</th>
                            <th class="px-4 py-2 text-left">Position (x,y)</th>
                            <th class="px-4 py-2 text-left">Size</th>
                            <th class="px-4 py-2 text-left">Confidence</th>
                            <th class="px-4 py-2 text-left">Field Position</th>
                        </tr>
                    </thead>
                    <tbody id="detectionTable" class="divide-y divide-gray-200">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // NFL Field Detection Mapper with Integrated Player Detection
        class NFLFieldMapper {
            constructor() {
                // Configuration
                this.API_KEY = "Imm66rNLdtpVKJSwH4Cl"; // Replace with your Roboflow API key
                this.API_URL = "https://serverless.roboflow.com/all-football/1";
                
                // Field dimensions
                this.fieldWidth = 1000;
                this.fieldHeight = 533;
                this.detections = [];
                this.originalImageDimensions = { width: 1280, height: 600 };
                this.currentImage = null;
                
                this.initializeField();
                this.setupEventListeners();
            }

            initializeField() {
                this.drawYardLines();
                this.drawHashMarks();
                this.drawFieldNumbers();
            }

            drawYardLines() {
                const yardLinesGroup = document.getElementById('yardLines');
                const fieldWidth = this.fieldWidth;
                const endZoneWidth = fieldWidth / 12;
                const playingFieldWidth = fieldWidth - (2 * endZoneWidth);
                
                for (let i = 0; i <= 20; i++) {
                    const x = endZoneWidth + (i * playingFieldWidth / 20);
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', x);
                    line.setAttribute('y1', 0);
                    line.setAttribute('x2', x);
                    line.setAttribute('y2', this.fieldHeight);
                    line.setAttribute('class', 'yard-line');
                    yardLinesGroup.appendChild(line);
                }

                [endZoneWidth, fieldWidth - endZoneWidth].forEach(x => {
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', x);
                    line.setAttribute('y1', 0);
                    line.setAttribute('x2', x);
                    line.setAttribute('y2', this.fieldHeight);
                    line.setAttribute('stroke', 'white');
                    line.setAttribute('stroke-width', '4');
                    yardLinesGroup.appendChild(line);
                });
            }

            drawHashMarks() {
                const hashMarksGroup = document.getElementById('hashMarks');
                const fieldWidth = this.fieldWidth;
                const fieldHeight = this.fieldHeight;
                const endZoneWidth = fieldWidth / 12;
                const playingFieldWidth = fieldWidth - (2 * endZoneWidth);
                
                const hashY1 = fieldHeight * 0.3;
                const hashY2 = fieldHeight * 0.7;
                
                for (let i = 1; i < 20; i++) {
                    const x = endZoneWidth + (i * playingFieldWidth / 20);
                    
                    const hash1 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    hash1.setAttribute('x1', x);
                    hash1.setAttribute('y1', hashY1 - 10);
                    hash1.setAttribute('x2', x);
                    hash1.setAttribute('y2', hashY1 + 10);
                    hash1.setAttribute('class', 'hash-mark');
                    hashMarksGroup.appendChild(hash1);
                    
                    const hash2 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    hash2.setAttribute('x1', x);
                    hash2.setAttribute('y1', hashY2 - 10);
                    hash2.setAttribute('x2', x);
                    hash2.setAttribute('y2', hashY2 + 10);
                    hash2.setAttribute('class', 'hash-mark');
                    hashMarksGroup.appendChild(hash2);
                }
            }

            drawFieldNumbers() {
                const numbersGroup = document.getElementById('fieldNumbers');
                const fieldWidth = this.fieldWidth;
                const fieldHeight = this.fieldHeight;
                const endZoneWidth = fieldWidth / 12;
                const playingFieldWidth = fieldWidth - (2 * endZoneWidth);
                
                const yardNumbers = [10, 20, 30, 40, 50, 40, 30, 20, 10];
                
                yardNumbers.forEach((number, index) => {
                    const x = endZoneWidth + ((index + 1) * 2 * playingFieldWidth / 20);
                    
                    const topText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    topText.setAttribute('x', x);
                    topText.setAttribute('y', fieldHeight * 0.25);
                    topText.setAttribute('class', 'field-numbers');
                    topText.textContent = number;
                    numbersGroup.appendChild(topText);
                    
                    const bottomText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    bottomText.setAttribute('x', x);
                    bottomText.setAttribute('y', fieldHeight * 0.75);
                    bottomText.setAttribute('class', 'field-numbers');
                    bottomText.setAttribute('transform', `rotate(180 ${x} ${fieldHeight * 0.75})`);
                    bottomText.textContent = number;
                    numbersGroup.appendChild(bottomText);
                });
            }

            setupEventListeners() {
                // Image upload
                document.getElementById('imageFile').addEventListener('change', (e) => {
                    this.handleImageUpload(e.target.files[0]);
                });

                // Detection button
                document.getElementById('detectPlayers').addEventListener('click', () => {
                    this.detectPlayersInImage();
                });

                // Sample data
                document.getElementById('loadSample').addEventListener('click', () => {
                    this.loadSampleData();
                });

                // JSON file upload
                document.getElementById('loadJsonFile').addEventListener('click', () => {
                    document.getElementById('jsonFileInput').click();
                });

                document.getElementById('jsonFileInput').addEventListener('change', (e) => {
                    this.loadJsonFile(e.target.files[0]);
                });

                // Clear button
                document.getElementById('clearField').addEventListener('click', () => {
                    this.clearAll();
                });
            }

            handleImageUpload(file) {
                if (!file) return;

                this.currentImage = file;
                const detectButton = document.getElementById('detectPlayers');
                
                // Enable detect button
                detectButton.disabled = false;
                detectButton.classList.remove('opacity-50');

                // Show image preview
                const reader = new FileReader();
                reader.onload = (e) => {
                    const container = document.getElementById('imagePreviewContainer');
                    container.innerHTML = `<img src="${e.target.result}" class="image-preview" alt="Uploaded image">`;
                    
                    // Get image dimensions for mapping
                    const img = new Image();
                    img.onload = () => {
                        this.originalImageDimensions = { width: img.width, height: img.height };
                        console.log('Image dimensions:', this.originalImageDimensions);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }

            async detectPlayersInImage() {
                if (!this.currentImage) {
                    alert('Please upload an image first');
                    return;
                }

                this.showProcessingStatus(true, 'Converting image to base64...');
                
                try {
                    // Convert image to base64
                    const base64Image = await this.imageToBase64(this.currentImage);
                    
                    this.showProcessingStatus(true, 'Sending to detection service...');
                    
                    // Make API request
                    const response = await fetch(`${this.API_URL}?api_key=${this.API_KEY}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: base64Image
                    });

                    if (!response.ok) {
                        throw new Error(`API request failed: ${response.status} ${response.statusText}`);
                    }

                    this.showProcessingStatus(true, 'Processing detection results...');
                    
                    const data = await response.json();
                    
                    // Process results
                    this.processDetections(data);
                    
                    this.showProcessingStatus(false);
                    
                    // Show success message
                    this.showSuccessMessage(`Successfully detected ${data.predictions.length} objects!`);

                } catch (error) {
                    this.showProcessingStatus(false);
                    this.showErrorMessage('Detection failed: ' + error.message);
                    console.error('Detection error:', error);
                }
            }

            imageToBase64(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = () => {
                        // Remove data:image/jpeg;base64, prefix
                        const base64 = reader.result.split(',')[1];
                        resolve(base64);
                    };
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
            }

            showProcessingStatus(show, message = '') {
                const statusDiv = document.getElementById('processingStatus');
                const messageDiv = document.getElementById('processingMessage');
                const detectButton = document.getElementById('detectPlayers');
                const spinner = detectButton.querySelector('.loading-spinner');
                const buttonText = detectButton.querySelector('.button-text');
                
                if (show) {
                    statusDiv.classList.remove('hidden');
                    messageDiv.textContent = message;
                    detectButton.disabled = true;
                    spinner.classList.remove('hidden');
                    buttonText.textContent = 'Processing...';
                } else {
                    statusDiv.classList.add('hidden');
                    detectButton.disabled = false;
                    spinner.classList.add('hidden');
                    buttonText.textContent = 'üîç Detect Players';
                }
            }

            showSuccessMessage(message) {
                this.showTemporaryMessage(message, 'success');
            }

            showErrorMessage(message) {
                this.showTemporaryMessage(message, 'error');
            }

            showTemporaryMessage(message, type) {
                const existingMessage = document.getElementById('tempMessage');
                if (existingMessage) {
                    existingMessage.remove();
                }

                const messageDiv = document.createElement('div');
                messageDiv.id = 'tempMessage';
                messageDiv.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${
                    type === 'success' ? 'bg-green-500 text-white' : 'bg-red-500 text-white'
                }`;
                messageDiv.textContent = message;
                
                document.body.appendChild(messageDiv);
                
                setTimeout(() => {
                    messageDiv.remove();
                }, 5000);
            }

            loadJsonFile(file) {
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        this.processDetections(data);
                        this.showSuccessMessage('JSON file loaded successfully!');
                    } catch (error) {
                        this.showErrorMessage('Error parsing JSON file: ' + error.message);
                    }
                };
                reader.readAsText(file);
            }

            loadSampleData() {
                const sampleData = {
                    "predictions": [
                        {"x": 756.5, "y": 550, "width": 61, "height": 100, "confidence": 0.92, "class": "player", "class_id": 0, "detection_id": "a03d99a8-2c4a-4080-84bd-1190b511088b"},
                        {"x": 548, "y": 232.5, "width": 76, "height": 77, "confidence": 0.918, "class": "player", "class_id": 0, "detection_id": "711a3324-5fa7-4026-9ea7-3d01c1ee7694"},
                        {"x": 546.5, "y": 96.5, "width": 65, "height": 79, "confidence": 0.916, "class": "player", "class_id": 0, "detection_id": "a26a87d0-51d7-4a7d-8fdd-58489c4002cc"},
                        {"x": 561, "y": 408, "width": 74, "height": 104, "confidence": 0.913, "class": "player", "class_id": 0, "detection_id": "8069ac76-7a4b-421e-8853-b10af6d0cbb6"},
                        {"x": 575, "y": 314.5, "width": 86, "height": 81, "confidence": 0.912, "class": "player", "class_id": 0, "detection_id": "3d7fcade-14f3-4fc0-abcc-563641b72618"},
                        {"x": 986, "y": 217, "width": 50, "height": 98, "confidence": 0.909, "class": "player", "class_id": 0, "detection_id": "d248b7c8-a331-4b90-abd2-4ae8d9134ed7"},
                        {"x": 640.5, "y": 291, "width": 71, "height": 98, "confidence": 0.908, "class": "player", "class_id": 0, "detection_id": "a604e466-716f-4d02-acd1-be0ee9c543ad"},
                        {"x": 1245.5, "y": 365, "width": 53, "height": 102, "confidence": 0.908, "class": "player", "class_id": 0, "detection_id": "f3a23aaa-33fe-4fa0-a6f6-114724568237"},
                        {"x": 1021.5, "y": 397, "width": 33, "height": 126, "confidence": 0.873, "class": "ref", "class_id": 1, "detection_id": "0eecc7c0-73f5-4187-9bd7-c56de9e2a492"},
                        {"x": 683, "y": 29, "width": 36, "height": 58, "confidence": 0.532, "class": "ref", "class_id": 1, "detection_id": "c9fe098b-206f-40d2-846b-8755f3b4bd3a"}
                    ]
                };
                
                this.originalImageDimensions = { width: 1280, height: 600 };
                this.processDetections(sampleData);
                this.showSuccessMessage('Sample data loaded successfully!');
            }

            processDetections(data) {
                this.detections = data.predictions || [];
                this.updateStatistics();
                this.renderDetections();
                this.updateDetectionTable();
            }

            updateStatistics() {
                const players = this.detections.filter(d => d.class === 'player');
                const refs = this.detections.filter(d => d.class === 'ref');
                const totalConfidence = this.detections.reduce((sum, d) => sum + d.confidence, 0);
                const avgConfidence = this.detections.length > 0 ? (totalConfidence / this.detections.length) : 0;

                document.getElementById('playerCount').textContent = players.length;
                document.getElementById('refCount').textContent = refs.length;
                document.getElementById('totalCount').textContent = this.detections.length;
                document.getElementById('avgConfidence').textContent = Math.round(avgConfidence * 100) + '%';
            }

            renderDetections() {
                const markersGroup = document.getElementById('detectionMarkers');
                markersGroup.innerHTML = '';

                this.detections.forEach((detection, index) => {
                    const fieldPos = this.mapToFieldPosition(detection.x, detection.y);
                    const marker = this.createDetectionMarker(detection, fieldPos, index);
                    markersGroup.appendChild(marker);
                });
            }

            mapToFieldPosition(x, y) {
                const fieldX = (x / this.originalImageDimensions.width) * this.fieldWidth;
                const fieldY = (y / this.originalImageDimensions.height) * this.fieldHeight;
                
                return { x: fieldX, y: fieldY };
            }

            createDetectionMarker(detection, position, index) {
                const group = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                group.setAttribute('class', 'field-marker');
                group.setAttribute('data-detection-id', detection.detection_id);

                let color = '#3b82f6';
                if (detection.class === 'ref') {
                    color = '#eab308';
                }
                if (detection.confidence < 0.7) {
                    color = '#ef4444';
                }

                const radius = Math.max(4, Math.min(12, detection.confidence * 15));

                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', position.x);
                circle.setAttribute('cy', position.y);
                circle.setAttribute('r', radius);
                circle.setAttribute('fill', color);
                circle.setAttribute('stroke', 'white');
                circle.setAttribute('stroke-width', '2');
                circle.setAttribute('opacity', '0.8');

                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', position.x);
                text.setAttribute('y', position.y - radius - 5);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('fill', 'white');
                text.setAttribute('font-size', '10');
                text.setAttribute('font-weight', 'bold');
                text.textContent = Math.round(detection.confidence * 100) + '%';

                const title = document.createElementNS('http://www.w3.org/2000/svg', 'title');
                title.textContent = `${detection.class.toUpperCase()} - ${Math.round(detection.confidence * 100)}% confidence\nPosition: (${Math.round(detection.x)}, ${Math.round(detection.y)})\nID: ${detection.detection_id.substring(0, 8)}...`;

                group.appendChild(circle);
                group.appendChild(text);
                group.appendChild(title);

                group.addEventListener('click', () => {
                    this.highlightDetectionInTable(index);
                });

                return group;
            }

            highlightDetectionInTable(index) {
                document.querySelectorAll('#detectionTable tr').forEach(row => {
                    row.classList.remove('bg-blue-100');
                });

                const row = document.querySelector(`#detectionTable tr[data-index="${index}"]`);
                if (row) {
                    row.classList.add('bg-blue-100');
                    row.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }

            updateDetectionTable() {
                const tableBody = document.getElementById('detectionTable');
                tableBody.innerHTML = '';

                this.detections.forEach((detection, index) => {
                    const row = document.createElement('tr');
                    row.setAttribute('data-index', index);
                    row.className = 'hover:bg-gray-50 cursor-pointer';
                    
                    const fieldPos = this.getFieldYardage(detection.x);
                    
                    row.innerHTML = `
                        <td class="px-4 py-2 text-sm">${detection.detection_id.substring(0, 8)}...</td>
                        <td class="px-4 py-2">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                                detection.class === 'player' ? 'bg-blue-100 text-blue-800' : 'bg-yellow-100 text-yellow-800'
                            }">
                                ${detection.class}
                            </span>
                        </td>
                        <td class="px-4 py-2 text-sm">(${Math.round(detection.x)}, ${Math.round(detection.y)})</td>
                        <td class="px-4 py-2 text-sm">${detection.width}√ó${detection.height}</td>
                        <td class="px-4 py-2">
                            <div class="flex items-center">
                                <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                    <div class="bg-green-600 h-2 rounded-full" style="width: ${detection.confidence * 100}%"></div>
                                </div>
                                <span class="text-sm font-medium">${Math.round(detection.confidence * 100)}%</span>
                            </div>
                        </td>
                        <td class="px-4 py-2 text-sm">${fieldPos}</td>
                    `;

                    row.addEventListener('click', () => {
                        this.highlightDetectionOnField(index);
                    });

                    tableBody.appendChild(row);
                });
            }

            getFieldYardage(x) {
                const fieldPercent = x / this.originalImageDimensions.width;
                const yardLine = Math.round(fieldPercent * 120);
                
                if (yardLine <= 10) return `${10 - yardLine} yard line (End Zone)`;
                if (yardLine >= 110) return `${yardLine - 110} yard line (End Zone)`;
                
                const adjustedYard = yardLine - 10;
                if (adjustedYard <= 50) return `${adjustedYard} yard line`;
                return `${100 - adjustedYard} yard line`;
            }

            highlightDetectionOnField(index) {
                document.querySelectorAll('.field-marker circle').forEach(circle => {
                    circle.setAttribute('stroke-width', '2');
                    circle.setAttribute('opacity', '0.8');
                });

                const markers = document.querySelectorAll('.field-marker');
                if (markers[index]) {
                    const circle = markers[index].querySelector('circle');
                    circle.setAttribute('stroke-width', '4');
                    circle.setAttribute('opacity', '1');
                }
            }

            clearAll() {
                this.detections = [];
                this.currentImage = null;
                this.originalImageDimensions = { width: 1280, height: 600 };
                
                document.getElementById('detectionMarkers').innerHTML = '';
                document.getElementById('detectionTable').innerHTML = '';
                document.getElementById('imageFile').value = '';
                document.getElementById('jsonFileInput').value = '';
                document.getElementById('imagePreviewContainer').innerHTML = `
                    <div class="text-gray-500">
                        <svg class="mx-auto h-12 w-12 mb-2" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                            <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <p>No image selected</p>
                    </div>
                `;
                
                const detectButton = document.getElementById('detectPlayers');
                detectButton.disabled = true;
                detectButton.classList.add('opacity-50');
                
                this.updateStatistics();
                this.showSuccessMessage('All data cleared successfully!');
            }
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new NFLFieldMapper();
        });
    </script>
</body>
</html>